<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3M-SECURE Signup</title>
    <link rel="icon" sizes="16x16" href="images/3msecure.svg" type="image/x-svg" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #35607A, #1473AE);
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .main-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            padding: 20px;
        }

        .header {
            background-color: #1F3B4D;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            color: white;
            font-size: 18px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            display: flex;
            border: none;
            align-items: center;
            text-decoration: none;
        }

        .logo span {
            color: #7ED957;
        }

        .home-icon {
            width: 40px;
            height: 40px;
        }

        .home-icon img {
            width: 100%;
            height: 100%;
        }

        .signup-card {
            background: white;
            border-radius: 15px;
            padding: 29px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 10px 3px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 19px;
        }

        .signup-btn {
            width: 100%;
            padding: 12px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            color: #777;
            position: relative;
        }

        .divider::before,
        .divider::after {
            content: "";
            position: absolute;
            top: 50%;
            width: 45%;
            height: 1px;
            background-color: #ccc;
        }

        .divider::before {
            left: 0;
        }

        .divider::after {
            right: 0;
        }

        .google-btn {
            width: 100%;
            padding: 10px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
        }

        .google-btn img {
            width: 20px;
            margin-right: 10px;
        }

        .signup-link {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        .signup-link a {
            color: #3498db;
            text-decoration: none;
        }

        .success-message {
            background-color: #4caf50;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 16px;
            border-radius: 5px;
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            animation: slideDown 0.5s ease-out;
            z-index: 1001;
        }

        @keyframes slideDown {
            0% {
                transform: translate(-50%, -100%);
            }

            100% {
                transform: translate(-50%, -50%);
            }
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            color: white;
            background-color: #f44336;
            border-radius: 5px;
            text-align: center;
            animation: shake 0.82s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }

            30%,
            50%,
            70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%,
            60% {
                transform: translate3d(4px, 0, 0);
            }
        }

        .hidden {
            display: none;
        }

        .spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: none;
            z-index: 1002;
        }

        @keyframes spin {
            0% {
                transform: translate(-50%, -50%) rotate(0deg);
            }

            100% {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <a href="#" class="logo"><span>3M-</span>SECURE</a>
            <a href="index.html" class="home-icon"><img src="images/home.png" alt="home icon"></a>
        </header>
        <div class="main-content">
            <div class="signup-card">
                <div id="error_alert" class="alert hidden">Error message here.</div>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" required>
                    </div>
                    <div class="form-group">
                        <label for="retype-password">Retype Password</label>
                        <input type="password" id="retype-password" required>
                    </div>
                    <button type="submit" class="signup-btn">Signup</button>
                </form>
                <div class="divider">OR</div>
                <button class="google-btn" id="google-signin">
                    <img src="images/google.png" alt="Google logo">
                    Signup With Google
                </button>
                <div class="signup-link">
                    Already have an account? <a href="login.html">Login</a>
                </div>
                <div class="spinner" id="spinner"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithPopup,
            sendEmailVerification,
            GoogleAuthProvider,
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";


        const firebaseConfig = {
            apiKey: "AIzaSyAOu_01IAtFujx33_ZBFXq5KOQXUytomi0",
            authDomain: "guardpointx.firebaseapp.com",
            projectId: "guardpointx",
            storageBucket: "guardpointx.appspot.com",
            messagingSenderId: "1002461591352",
            appId: "1:1002461591352:web:35530624b69ecc90f1f3cd",
            measurementId: "G-X44KLQK52W"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider();
        const auth = getAuth(app);
        const database = getDatabase(app);

        const google_signup = document.getElementById("google-signin");

        let signupForm = document.getElementById("signup-form");
        let emailInput = document.getElementById("email");
        let passwordInput = document.getElementById("password");
        let retypePasswordInput = document.getElementById("retype-password");
        let spinner = document.getElementById("spinner");

        function displayAlert(message) {
            const alertBox = document.getElementById("error_alert");
            alertBox.textContent = message;
            alertBox.classList.remove("hidden");
            setTimeout(() => {
                alertBox.classList.add("hidden");
            }, 5000);
        }

        google_signup.addEventListener("click", async function () {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                const displayName = user.displayName;
                const userId = user.uid;
                const email = user.email;
                await set(ref(database, 'users/' + userId), {
                    uid: userId,
                    email: email
                });

                console.log('User signed up and user ID stored in database.');
                window.location.href = "login.html";
            } catch (error) {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.log(errorMessage);
                console.log(errorCode);
            }
        });

        async function registerUser(evt) {
            evt.preventDefault();
            spinner.style.display = "block";
            let email = emailInput.value;
            let password = passwordInput.value;
            let retypePassword = retypePasswordInput.value;

            if (password !== retypePassword) {
                displayAlert("Passwords do not match.");
                spinner.style.display = "none";
                return;
            }

            try {
                const credentials = await createUserWithEmailAndPassword(auth, email, password);
                const user = credentials.user;
                const userId = user.uid;

                await set(ref(database, 'users/' + userId), {
                    uid: userId,
                    email: email
                });

                console.log('do you know we are looking for opensourcer to improve our application.');

                await sendEmailVerification(auth.currentUser);
                const messageDiv = document.createElement("div");
                messageDiv.className = "success-message";
                messageDiv.textContent = "Email Verification Link Sent!";
                document.body.appendChild(messageDiv);
                setTimeout(() => document.body.removeChild(messageDiv), 3000);

                const messageDiv2 = document.createElement("div");
                messageDiv2.className = "success-message";
                messageDiv2.textContent = "Check Email For Verification Message!";

                signupForm.reset();
                document.body.appendChild(messageDiv2);
                setTimeout(() => document.body.removeChild(messageDiv2), 3000);
                spinner.style.display = "none";
                setTimeout(() => {
                    window.location.href = "login.html";
                }, 5000);

            } catch (error) {
                if (error.code === "auth/email-already-in-use" || error.code === "auth/fullname-already-in-use") {
                    displayAlert("User already exist.");
                } else {
                    displayAlert("Signup failed: " + error.message);
                }
                spinner.style.display = "none";
                console.log(error.code, error.message);
            }
        }
        document.addEventListener('DOMContentLoaded', function () {
            const card = document.querySelector('.signup-card');
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s, transform 0.5s';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100);

            signupForm.addEventListener('submit', registerUser);
        });
    </script>
</body>

</html>